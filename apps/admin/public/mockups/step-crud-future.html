<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step CRUD — FUTURE STATE (HA-inspired)</title>
<style>
  :root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface-raised: #22252f;
    --border: #2e3140;
    --border-hover: #3d4155;
    --text: #e4e5e9;
    --text-secondary: #8b8fa3;
    --text-muted: #5c6078;
    --accent: #3b82f6;
    --red: #ef4444;
    --green: #22c55e;
    --yellow: #eab308;
    --purple: #8b5cf6;
    --indigo: #4338ca;
    --orange: #f97316;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg);
    color: var(--text);
    padding: 32px;
    min-height: 100vh;
  }
  .page-title {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-muted);
    margin-bottom: 8px;
    font-weight: 600;
  }
  h1 { font-size: 22px; font-weight: 700; margin-bottom: 24px; }
  .badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
  }

  /* --- DIFF GUIDE MARKS --- */
  .guide {
    position: relative;
  }
  .guide::before {
    content: attr(data-label);
    position: absolute;
    top: -10px;
    right: -6px;
    background: var(--orange);
    color: #000;
    font-size: 9px;
    font-weight: 800;
    padding: 2px 6px;
    border-radius: 4px;
    z-index: 10;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
  }
  .guide-outline {
    outline: 2px solid var(--orange);
    outline-offset: 3px;
    border-radius: 10px;
  }
  .guide-new::before { background: var(--green); }
  .guide-changed::before { background: var(--yellow); color: #000; }

  /* Layout */
  .main-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    max-width: 680px;
    margin: 0 auto;
  }
  .panel-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-muted);
    margin-bottom: 16px;
    font-weight: 600;
  }

  /* --- SECTION HEADERS (HA "When / And if / Then do") --- */
  .section {
    margin-bottom: 20px;
  }
  .section-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
    padding-bottom: 6px;
    border-bottom: 1px solid var(--border);
  }
  .section-verb {
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    padding: 3px 10px;
    border-radius: 6px;
  }
  .section-count {
    font-size: 10px;
    color: var(--text-muted);
    font-weight: 500;
  }
  .section-add {
    margin-left: auto;
    font-size: 11px;
    color: var(--accent);
    background: none;
    border: none;
    cursor: pointer;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 4px;
    transition: background 0.15s;
  }
  .section-add:hover { background: rgba(59,130,246,0.1); }

  /* --- STEP CARD (unified) --- */
  .step-card {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 11px 12px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--surface-raised);
    margin-bottom: 6px;
    transition: all 0.15s;
    cursor: pointer;
    position: relative;
  }
  .step-card:hover { border-color: var(--border-hover); }
  .step-card.disabled-step {
    opacity: 0.45;
    border-style: dashed;
  }

  /* Drag handle */
  .drag-handle {
    color: var(--text-muted);
    font-size: 14px;
    cursor: grab;
    user-select: none;
    flex-shrink: 0;
    line-height: 20px;
    transition: color 0.15s;
  }
  .step-card:hover .drag-handle { color: var(--text-secondary); }

  /* Step number circle */
  .step-circle {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 700;
    flex-shrink: 0;
    border: 1.5px solid var(--border);
    color: var(--text-secondary);
    background: var(--surface);
  }

  /* Content */
  .step-content { flex: 1; min-width: 0; }
  .step-title-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .step-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .step-subtitle {
    font-size: 11px;
    color: var(--text-secondary);
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .step-tags {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
    margin-top: 5px;
  }
  .tag {
    font-size: 9px;
    padding: 2px 7px;
    border-radius: 5px;
    font-weight: 500;
  }
  .tag-blue { background: rgba(59,130,246,0.12); color: #60a5fa; }
  .tag-green { background: rgba(34,197,94,0.12); color: #4ade80; }
  .tag-purple { background: rgba(139,92,246,0.12); color: #a78bfa; }

  /* --- KEBAB MENU (NEW) --- */
  .kebab-trigger {
    width: 28px;
    height: 28px;
    border: none;
    background: none;
    color: var(--text-muted);
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    flex-shrink: 0;
    transition: all 0.15s;
    opacity: 0;
    letter-spacing: 1px;
  }
  .step-card:hover .kebab-trigger { opacity: 1; }
  .kebab-trigger:hover { background: rgba(255,255,255,0.06); color: var(--text); }

  /* Dropdown menu */
  .kebab-menu {
    position: absolute;
    top: 8px;
    right: 44px;
    background: var(--surface);
    border: 1px solid var(--border-hover);
    border-radius: 10px;
    padding: 4px;
    min-width: 160px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    z-index: 100;
  }
  .kebab-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 10px;
    border-radius: 6px;
    font-size: 12px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.1s;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
  }
  .kebab-item:hover { background: rgba(255,255,255,0.05); color: var(--text); }
  .kebab-item.danger { color: var(--red); }
  .kebab-item.danger:hover { background: rgba(239,68,68,0.08); }
  .kebab-icon { width: 14px; text-align: center; font-size: 12px; flex-shrink: 0; }
  .kebab-sep { height: 1px; background: var(--border); margin: 4px 6px; }

  /* --- ENABLE/DISABLE TOGGLE (NEW) --- */
  .toggle-track {
    width: 28px;
    height: 16px;
    border-radius: 8px;
    background: var(--border);
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
    flex-shrink: 0;
  }
  .toggle-track.on { background: var(--green); }
  .toggle-knob {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: white;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: left 0.2s;
  }
  .toggle-track.on .toggle-knob { left: 14px; }

  /* --- ADD BUTTON (enhanced) --- */
  .add-btn {
    padding: 8px 16px;
    border-radius: 8px;
    border: 1px dashed var(--border);
    background: transparent;
    font-size: 12px;
    cursor: pointer;
    color: var(--text-secondary);
    margin-top: 4px;
    transition: all 0.15s;
    width: 100%;
    text-align: center;
  }
  .add-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(59,130,246,0.05);
  }

  /* --- TYPE PICKER DIALOG (NEW) --- */
  .picker-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 200;
  }
  .picker-dialog {
    background: var(--surface);
    border: 1px solid var(--border-hover);
    border-radius: 16px;
    width: 520px;
    max-height: 420px;
    overflow: hidden;
    box-shadow: 0 16px 48px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
  }
  .picker-header {
    padding: 16px 20px 12px;
    border-bottom: 1px solid var(--border);
  }
  .picker-title { font-size: 15px; font-weight: 700; margin-bottom: 10px; }
  .picker-search {
    width: 100%;
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: var(--bg);
    color: var(--text);
    font-size: 13px;
    outline: none;
  }
  .picker-search:focus { border-color: var(--accent); }
  .picker-body {
    display: grid;
    grid-template-columns: 140px 1fr;
    flex: 1;
    overflow: hidden;
  }
  .picker-categories {
    border-right: 1px solid var(--border);
    padding: 8px;
    overflow-y: auto;
  }
  .picker-cat {
    padding: 7px 10px;
    border-radius: 6px;
    font-size: 12px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.1s;
    margin-bottom: 2px;
  }
  .picker-cat:hover { background: rgba(255,255,255,0.04); }
  .picker-cat.active { background: rgba(59,130,246,0.1); color: var(--accent); font-weight: 600; }
  .picker-items {
    padding: 8px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .picker-item {
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.1s;
  }
  .picker-item:hover { border-color: var(--accent); background: rgba(59,130,246,0.04); }
  .picker-item-name { font-size: 13px; font-weight: 600; }
  .picker-item-desc { font-size: 11px; color: var(--text-secondary); margin-top: 2px; }

  .chevron {
    font-size: 10px;
    color: var(--text-muted);
    transition: transform 0.2s;
    flex-shrink: 0;
  }

  .watermark {
    position: fixed;
    top: 16px;
    right: 20px;
    font-size: 11px;
    color: var(--green);
    text-transform: uppercase;
    letter-spacing: 2px;
    font-weight: 700;
  }

  /* Legend */
  .legend {
    display: flex;
    gap: 16px;
    margin-bottom: 24px;
    align-items: center;
    font-size: 11px;
    color: var(--text-secondary);
  }
  .legend-swatch {
    width: 10px;
    height: 10px;
    border-radius: 3px;
    display: inline-block;
    margin-right: 4px;
  }
</style>
</head>
<body>
<div class="watermark">FUTURE STATE</div>

<div class="page-title">Step CRUD — HA-Inspired Unified Component</div>
<h1>One &lt;SortableList&gt;, All Entities</h1>

<div class="legend">
  <span><span class="legend-swatch" style="background:var(--green);"></span> New</span>
  <span><span class="legend-swatch" style="background:var(--yellow);"></span> Changed</span>
  <span><span class="legend-swatch" style="background:var(--orange);"></span> Annotation</span>
</div>

<div style="display:grid;grid-template-columns:680px 1fr;gap:32px;">

<!-- === MAIN MOCKUP === -->
<div class="main-panel">

  <!-- ===== SECTION: MEASURE ===== -->
  <div class="section guide guide-new guide-outline" data-label="NEW: Section headers" style="margin-bottom:24px;">
    <div class="section-header">
      <span class="section-verb" style="background:rgba(139,92,246,0.15);color:#a78bfa;">Measure</span>
      <span class="section-count">2 steps</span>
      <button class="section-add">+ Add</button>
    </div>

    <!-- Card 1 -->
    <div class="step-card" style="position:relative;">
      <div class="drag-handle">⠿</div>
      <div class="step-circle">1</div>
      <div class="step-content">
        <div class="step-title-row">
          <span class="step-title">Extract Personality</span>
          <span class="badge" style="background:rgba(139,92,246,0.15);color:#a78bfa;">PERS-001</span>
          <!-- Toggle -->
          <div class="guide guide-new" data-label="NEW: Toggle" style="margin-left:auto;">
            <div class="toggle-track on">
              <div class="toggle-knob"></div>
            </div>
          </div>
        </div>
        <div class="step-subtitle">Measure Big Five traits from conversational cues</div>
        <div class="step-tags">
          <span class="tag tag-blue">openness</span>
          <span class="tag tag-blue">agreeableness</span>
          <span class="tag tag-purple">+3</span>
        </div>
      </div>
      <!-- Kebab -->
      <div class="guide guide-new" data-label="NEW: Kebab menu">
        <button class="kebab-trigger" style="opacity:1;">&#x22EE;</button>
      </div>
      <span class="chevron">&#x25BC;</span>
    </div>

    <!-- Card 2 — disabled -->
    <div class="step-card disabled-step" style="position:relative;">
      <div class="drag-handle">⠿</div>
      <div class="step-circle" style="border-style:dashed;">2</div>
      <div class="step-content">
        <div class="step-title-row">
          <span class="step-title" style="text-decoration:line-through;opacity:0.7;">VARK Learning Style</span>
          <span class="badge" style="background:rgba(139,92,246,0.1);color:#a78bfa;opacity:0.5;">VARK-001</span>
          <div style="margin-left:auto;">
            <div class="toggle-track">
              <div class="toggle-knob"></div>
            </div>
          </div>
        </div>
        <div class="step-subtitle">Disabled — will be skipped during pipeline execution</div>
      </div>
      <button class="kebab-trigger" style="opacity:0.4;">&#x22EE;</button>
      <span class="chevron">&#x25BC;</span>
    </div>
  </div>

  <!-- ===== SECTION: COMPOSE ===== -->
  <div class="section">
    <div class="section-header">
      <span class="section-verb" style="background:rgba(34,197,94,0.15);color:#4ade80;">Compose</span>
      <span class="section-count">1 step</span>
      <button class="section-add">+ Add</button>
    </div>

    <!-- Card 3 — with open kebab menu -->
    <div class="step-card" style="border-color:var(--border-hover);position:relative;">
      <div class="drag-handle">⠿</div>
      <div class="step-circle" style="border-color:var(--green);color:var(--green);">3</div>
      <div class="step-content">
        <div class="step-title-row">
          <span class="step-title">Compose Prompt</span>
          <span class="badge" style="background:rgba(34,197,94,0.15);color:#4ade80;">COMP-001</span>
          <div style="margin-left:auto;">
            <div class="toggle-track on">
              <div class="toggle-knob"></div>
            </div>
          </div>
        </div>
        <div class="step-subtitle">Build final prompt from personality, memories, and targets</div>
      </div>
      <button class="kebab-trigger" style="opacity:1;background:rgba(255,255,255,0.06);">&#x22EE;</button>
      <span class="chevron">&#x25BC;</span>

      <!-- OPEN KEBAB MENU -->
      <div class="kebab-menu guide guide-new guide-outline" data-label="NEW: Per-card actions">
        <button class="kebab-item"><span class="kebab-icon">&#x270E;</span> Rename</button>
        <button class="kebab-item"><span class="kebab-icon">&#x2398;</span> Duplicate</button>
        <button class="kebab-item"><span class="kebab-icon">&#x2398;</span> Copy</button>
        <button class="kebab-item"><span class="kebab-icon">&#x2702;</span> Cut</button>
        <div class="kebab-sep"></div>
        <button class="kebab-item"><span class="kebab-icon">&#x25B2;</span> Move to Measure</button>
        <button class="kebab-item"><span class="kebab-icon">&#x23CF;</span> Disable</button>
        <div class="kebab-sep"></div>
        <button class="kebab-item danger"><span class="kebab-icon">&#x2716;</span> Delete</button>
      </div>
    </div>

    <!-- Dashed add within section -->
    <button class="add-btn" style="font-size:11px;padding:6px 12px;border-color:rgba(34,197,94,0.2);color:rgba(34,197,94,0.5);">
      + Add compose step
    </button>
  </div>

</div>

<!-- === TYPE PICKER (shown alongside) === -->
<div style="display:flex;flex-direction:column;gap:24px;">

  <!-- Type picker dialog -->
  <div class="picker-dialog guide guide-new guide-outline" data-label="NEW: Type picker dialog" style="position:relative;">
    <div class="picker-header">
      <div class="picker-title">Add Measure Step</div>
      <input class="picker-search" placeholder="Search specs..." value="person" />
    </div>
    <div class="picker-body" style="height:280px;">
      <div class="picker-categories">
        <div class="picker-cat active">Personality</div>
        <div class="picker-cat">Learning Style</div>
        <div class="picker-cat">Memory</div>
        <div class="picker-cat">Engagement</div>
        <div class="picker-cat">Language</div>
        <div class="picker-cat">Custom</div>
      </div>
      <div class="picker-items">
        <div class="picker-item" style="border-color:var(--accent);background:rgba(59,130,246,0.04);">
          <div class="picker-item-name">Personality Analysis</div>
          <div class="picker-item-desc">Big Five traits — openness, agreeableness, conscientiousness, extraversion, neuroticism</div>
        </div>
        <div class="picker-item">
          <div class="picker-item-name">Personal Values</div>
          <div class="picker-item-desc">Detect core values and motivational drivers</div>
        </div>
        <div class="picker-item">
          <div class="picker-item-name">Personality Archetypes</div>
          <div class="picker-item-desc">Map to Jungian archetypes from conversation</div>
        </div>
      </div>
    </div>
  </div>

  <!-- DIFF SUMMARY -->
  <div style="padding:20px;border:1px solid var(--border);border-radius:12px;background:var(--surface);">
    <div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:12px;">Diff: Current &#x2192; Future</div>

    <div style="display:flex;flex-direction:column;gap:10px;font-size:12px;">

      <div style="display:flex;gap:8px;align-items:flex-start;">
        <span class="legend-swatch" style="background:var(--green);margin-top:4px;flex-shrink:0;"></span>
        <div>
          <div style="color:var(--text);font-weight:600;">Section headers</div>
          <div style="color:var(--text-secondary);">HA-style "Measure / Compose / Adapt" groupings with per-section <code>+ Add</code> button. Replaces flat list.</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:flex-start;">
        <span class="legend-swatch" style="background:var(--green);margin-top:4px;flex-shrink:0;"></span>
        <div>
          <div style="color:var(--text);font-weight:600;">Kebab menu per card</div>
          <div style="color:var(--text-secondary);">Rename, Duplicate, Copy, Cut, Move to section, Disable, Delete. Appears on hover. Biggest UX gap closed.</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:flex-start;">
        <span class="legend-swatch" style="background:var(--green);margin-top:4px;flex-shrink:0;"></span>
        <div>
          <div style="color:var(--text);font-weight:600;">Enable/disable toggle</div>
          <div style="color:var(--text-secondary);">Per-step toggle. Disabled steps show dashed border + strikethrough + reduced opacity. Card stays visible (not deleted).</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:flex-start;">
        <span class="legend-swatch" style="background:var(--green);margin-top:4px;flex-shrink:0;"></span>
        <div>
          <div style="color:var(--text);font-weight:600;">Type picker dialog</div>
          <div style="color:var(--text-secondary);">Two-pane dialog with search + categories when clicking "Add". No more blank items. HA's best pattern.</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:flex-start;">
        <span class="legend-swatch" style="background:var(--yellow);margin-top:4px;flex-shrink:0;"></span>
        <div>
          <div style="color:var(--text);font-weight:600;">Unified card layout</div>
          <div style="color:var(--text-secondary);">All 3 current patterns (FlowStepCard, LessonPlanEditor, DomainRow) collapse into one <code>&lt;SortableCard&gt;</code> with render slots.</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:flex-start;">
        <span class="legend-swatch" style="background:var(--yellow);margin-top:4px;flex-shrink:0;"></span>
        <div>
          <div style="color:var(--text);font-weight:600;">Drag + arrows coexist</div>
          <div style="color:var(--text-secondary);">Drag handle always present. &#x25B2;&#x25BC; arrows available in kebab menu as "Move up / Move down" for keyboard/accessibility.</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:flex-start;">
        <span class="legend-swatch" style="background:var(--yellow);margin-top:4px;flex-shrink:0;"></span>
        <div>
          <div style="color:var(--text);font-weight:600;">Step number circles</div>
          <div style="color:var(--text-secondary);">Replace plain text numbers with styled circles. Dashed circle for disabled steps. Color-coded by section.</div>
        </div>
      </div>

    </div>
  </div>

  <!-- Component API sketch -->
  <div style="padding:16px;border:1px solid var(--border);border-radius:12px;background:var(--surface);font-family:monospace;">
    <div style="font-size:11px;color:var(--text-muted);margin-bottom:8px;font-family:sans-serif;font-weight:600;">Component API sketch</div>
    <pre style="font-size:11px;color:var(--text-secondary);line-height:1.6;overflow-x:auto;"><span style="color:#c084fc;">&lt;SortableList</span>
  <span style="color:#60a5fa;">sections</span>={[
    { key: "measure", label: "Measure", color: "#a78bfa" },
    { key: "compose", label: "Compose", color: "#4ade80" },
  ]}
  <span style="color:#60a5fa;">items</span>={items}
  <span style="color:#60a5fa;">onReorder</span>={handleReorder}
  <span style="color:#60a5fa;">onAdd</span>={openTypePicker}
  <span style="color:#60a5fa;">onDuplicate</span>={duplicateItem}
  <span style="color:#60a5fa;">onToggle</span>={toggleEnabled}
  <span style="color:#60a5fa;">onRemove</span>={removeItem}
  <span style="color:#60a5fa;">renderCard</span>={(item) =&gt; (
    <span style="color:#c084fc;">&lt;PlaybookStepSummary</span> item={item} <span style="color:#c084fc;">/&gt;</span>
  )}
<span style="color:#c084fc;">/&gt;</span></pre>
  </div>

</div>
</div>

</body>
</html>
