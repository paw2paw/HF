{
  "$schema": "./feature-spec-schema.json",
  "id": "MEM-001",
  "title": "Caller Memory Extraction",
  "version": "1.0",
  "status": "Approved",
  "date": "2026-01-29",
  "domain": "memory",
  "specType": "SYSTEM",
  "outputType": "LEARN",
  "config": {
    "llmConfig": {
      "maxTokens": 2048,
      "temperature": 0.3,
      "engine": "claude",
      "systemPrompt": "You are a memory extraction specialist. Extract structured memories from call transcripts. Be precise and conservative with confidence scores. Only extract information the caller explicitly states or strongly implies."
    },
    "confidenceThreshold": 0.5,
    "transcriptTruncateLength": 8000
  },
  "story": {
    "asA": "Conversational AI System",
    "iWant": "To extract and store meaningful information about callers from conversations",
    "soThat": "I can personalize future interactions and demonstrate that I remember and value them as individuals"
  },
  "context": {
    "applies": "All voice conversations - memory extraction runs continuously",
    "dependsOn": [
      "PERS-001"
    ],
    "assumptions": [
      "Caller has consented to information being stored",
      "Extracted memories are verified before permanent storage",
      "Privacy regulations are followed for data retention"
    ]
  },
  "acceptanceCriteria": [
    {
      "id": "AC-MEM-001",
      "title": "Personal fact extraction",
      "given": "A caller sharing personal information during conversation",
      "when": "The system identifies factual statements about the caller",
      "then": "Personal facts are extracted with confidence scores and categories",
      "rationale": "Personal facts enable personalized service and relationship building",
      "measuredBy": [
        "MEM_FACTS"
      ]
    },
    {
      "id": "AC-MEM-002",
      "title": "Preference detection",
      "given": "A caller expressing likes, dislikes, or preferences",
      "when": "The system identifies preference statements",
      "then": "Preferences are captured with polarity and strength",
      "rationale": "Knowing preferences allows proactive personalization",
      "measuredBy": [
        "MEM_PREFS"
      ]
    },
    {
      "id": "AC-MEM-003",
      "title": "Context and situation capture",
      "given": "A caller describing their current situation or circumstances",
      "when": "The system identifies situational context",
      "then": "Context is captured with relevance and time-sensitivity flags",
      "rationale": "Situational context enables empathetic and relevant responses",
      "measuredBy": [
        "MEM_CONTEXT"
      ]
    },
    {
      "id": "AC-MEM-004",
      "title": "Relationship marker identification",
      "given": "A caller mentioning people in their life",
      "when": "The system identifies relationship references",
      "then": "Relationships are mapped with roles and importance",
      "rationale": "Understanding relationships enables more natural conversation",
      "measuredBy": [
        "MEM_RELATIONS"
      ]
    },
    {
      "id": "AC-MEM-005",
      "title": "Memory importance scoring",
      "given": "Extracted memory items from conversation",
      "when": "The system evaluates each memory for storage",
      "then": "Each memory is scored for importance and replay priority",
      "rationale": "Prioritizing important memories prevents information overload",
      "measuredBy": [
        "MEM_IMPORTANCE"
      ]
    }
  ],
  "constraints": [
    {
      "id": "CON-MEM-001",
      "type": "privacy",
      "description": "Sensitive personal information (health, financial details, SSN) must be flagged and handled according to privacy policy",
      "severity": "critical"
    },
    {
      "id": "CON-MEM-002",
      "type": "accuracy",
      "description": "Only store memories with confidence >= 0.7 to avoid storing incorrect information",
      "severity": "warning"
    },
    {
      "id": "CON-MEM-003",
      "type": "relevance",
      "description": "Memories should be relevant to future interactions, not just conversational noise",
      "severity": "warning"
    }
  ],
  "failureConditions": [
    {
      "id": "FC-MEM-001",
      "trigger": "confidence_score",
      "threshold": {
        "operator": "lt",
        "value": 0.5
      },
      "implication": "Memory too uncertain to store - discard or flag for verification",
      "severity": "warning"
    },
    {
      "id": "FC-MEM-002",
      "trigger": "contradiction_detected",
      "threshold": {
        "operator": "eq",
        "value": 1
      },
      "implication": "New memory contradicts existing memory - flag for resolution",
      "severity": "warning"
    }
  ],
  "parameters": [
    {
      "id": "MEM_FACTS",
      "name": "personal_facts",
      "description": "Factual information about the caller - demographics, life events, affiliations",
      "section": "Memory Types",
      "targetRange": {
        "min": 0.0,
        "max": 1.0
      },
      "formula": "extraction_confidence * relevance_score * specificity",
      "subMetrics": [
        {
          "id": "fact_specificity",
          "name": "Fact Specificity",
          "weight": 0.4,
          "description": "How specific and concrete the extracted fact is",
          "formula": "specific_details / vague_details",
          "definitions": {
            "high": "Exact names, dates, locations, numbers - 'My daughter Sarah just turned 16 on March 5th'",
            "low": "Vague references - 'I have kids' or 'I live somewhere in the midwest'"
          }
        },
        {
          "id": "fact_confidence",
          "name": "Extraction Confidence",
          "weight": 0.35,
          "description": "Confidence that the fact was correctly understood",
          "formula": "clarity_score * context_support",
          "definitions": {
            "high": "Clearly stated, unambiguous, confirmed or repeated",
            "low": "Mumbled, ambiguous, could be misheard or misinterpreted"
          }
        },
        {
          "id": "fact_relevance",
          "name": "Future Relevance",
          "weight": 0.25,
          "description": "Likelihood this fact will be useful in future interactions",
          "formula": "topic_relevance * reusability",
          "definitions": {
            "high": "Will clearly be relevant - family members, major life events, preferences affecting service",
            "low": "Unlikely to come up again - one-time context, transient information"
          }
        }
      ],
      "interpretationScale": [
        {
          "min": 0.0,
          "max": 0.3,
          "label": "Low Quality Fact",
          "implication": "Too vague or uncertain to store - discard"
        },
        {
          "min": 0.3,
          "max": 0.6,
          "label": "Moderate Quality",
          "implication": "Store with lower confidence, may need verification"
        },
        {
          "min": 0.6,
          "max": 0.8,
          "label": "Good Quality Fact",
          "implication": "Reliable enough to store and use"
        },
        {
          "min": 0.8,
          "max": 1.0,
          "label": "High Quality Fact",
          "implication": "Store as verified, high confidence recall"
        }
      ],
      "scoringAnchors": [
        {
          "score": 0.2,
          "example": "I think I mentioned something about... oh never mind, it's not important.",
          "rationale": "Vague, retracted, no actual fact extracted",
          "isGold": true
        },
        {
          "score": 0.4,
          "example": "We have a couple of cars in the family.",
          "rationale": "Some information but vague ('couple', 'family' undefined)",
          "isGold": true
        },
        {
          "score": 0.6,
          "example": "My wife drives a Honda - she's had it for a few years now.",
          "rationale": "Clear relationship and vehicle, but timeline vague",
          "isGold": true
        },
        {
          "score": 0.8,
          "example": "My daughter Emma is starting college at Ohio State in the fall.",
          "rationale": "Specific name, relationship, institution, timeframe - clear and relevant",
          "isGold": true
        },
        {
          "score": 0.95,
          "example": "We just bought a 2024 Toyota RAV4 last month for my son Jake - he's 17 and just got his license on December 15th.",
          "rationale": "Highly specific - exact vehicle, family member name, age, date - all clearly stated",
          "isGold": true
        }
      ],
      "promptGuidance": {
        "whenHigh": "High-quality personal facts detected. Store these with confidence and reference them naturally in future interactions to show you remember the caller.",
        "whenLow": "Information is too vague to store reliably. Don't assume details - if relevant, ask for clarification before storing.",
        "whenMedium": "Moderate quality facts. Store with appropriate confidence level. Can reference but be open to correction.",
        "promptTemplate": "{{#if (gte personal_facts 0.7)}}Remember: {{extracted_fact}} (high confidence){{else if (lte personal_facts 0.4)}}[Fact too vague to store reliably]{{/if}}"
      },
      "usedBy": [
        "AC-MEM-001"
      ]
    },
    {
      "id": "MEM_PREFS",
      "name": "preferences",
      "description": "Caller's expressed likes, dislikes, and preferences that can guide future interactions",
      "section": "Memory Types",
      "targetRange": {
        "min": 0.0,
        "max": 1.0
      },
      "formula": "preference_clarity * strength * stability",
      "subMetrics": [
        {
          "id": "preference_clarity",
          "name": "Preference Clarity",
          "weight": 0.4,
          "description": "How clearly the preference was expressed",
          "formula": "explicit_statements / implicit_signals",
          "definitions": {
            "high": "Explicitly stated - 'I prefer email over phone calls' or 'I don't like automated systems'",
            "low": "Implied or inferred - might prefer something based on behavior"
          }
        },
        {
          "id": "preference_strength",
          "name": "Preference Strength",
          "weight": 0.35,
          "description": "How strong the preference is (mild preference vs strong aversion)",
          "formula": "intensity_markers * repetition",
          "definitions": {
            "high": "Strong language - 'I hate', 'I always', 'I never', 'It's really important'",
            "low": "Mild preference - 'I kind of prefer', 'It would be nice if'"
          }
        },
        {
          "id": "preference_stability",
          "name": "Preference Stability",
          "weight": 0.25,
          "description": "Likelihood the preference will persist over time",
          "formula": "context_independence * generalizability",
          "definitions": {
            "high": "General preference likely to persist - communication style, general values",
            "low": "Situational preference that may change - 'right now I prefer'"
          }
        }
      ],
      "interpretationScale": [
        {
          "min": 0.0,
          "max": 0.3,
          "label": "Weak/Unclear Preference",
          "implication": "Not strong enough to act on - note but don't assume"
        },
        {
          "min": 0.3,
          "max": 0.6,
          "label": "Moderate Preference",
          "implication": "Consider in interactions but flexible"
        },
        {
          "min": 0.6,
          "max": 0.8,
          "label": "Clear Preference",
          "implication": "Honor this preference in future interactions"
        },
        {
          "min": 0.8,
          "max": 1.0,
          "label": "Strong Preference",
          "implication": "Important to the caller - always respect this"
        }
      ],
      "scoringAnchors": [
        {
          "score": 0.2,
          "example": "I guess email is fine.",
          "rationale": "Acceptance rather than preference, no enthusiasm, might just be going along",
          "isGold": true
        },
        {
          "score": 0.4,
          "example": "I'd probably rather get an email about this if that's an option.",
          "rationale": "Mild preference expressed with hedging language, conditional",
          "isGold": true
        },
        {
          "score": 0.6,
          "example": "I prefer to handle things by email - it gives me time to think.",
          "rationale": "Clear preference with reasoning, shows intention",
          "isGold": true
        },
        {
          "score": 0.8,
          "example": "Please don't call me - I really prefer email for everything. I've told other companies this too.",
          "rationale": "Strong explicit preference, repeated behavior, clear instruction",
          "isGold": true
        },
        {
          "score": 0.95,
          "example": "I absolutely HATE phone calls. Never call me. Email only, always. I've had my number removed from other companies' systems because I cannot stand phone calls.",
          "rationale": "Extremely strong language, absolute terms, cross-company pattern, emotional intensity",
          "isGold": true
        }
      ],
      "promptGuidance": {
        "whenHigh": "Strong preference detected. This is important to the caller - make sure to honor it and note it prominently in their profile.",
        "whenLow": "Weak or situational preference. Don't over-index on this - it may change or just be mild politeness.",
        "whenMedium": "Clear preference worth noting. Respect it when possible but it's not critical.",
        "promptTemplate": "{{#if (gte preferences 0.8)}}IMPORTANT: Caller strongly prefers {{preference}} - always honor this.{{else if (gte preferences 0.5)}}Preference noted: {{preference}}{{/if}}"
      },
      "usedBy": [
        "AC-MEM-002"
      ]
    },
    {
      "id": "MEM_CONTEXT",
      "name": "situational_context",
      "description": "Caller's current life situation, circumstances, or temporary context relevant to interactions",
      "section": "Memory Types",
      "targetRange": {
        "min": 0.0,
        "max": 1.0
      },
      "formula": "relevance * time_sensitivity * actionability",
      "subMetrics": [
        {
          "id": "context_relevance",
          "name": "Context Relevance",
          "weight": 0.4,
          "description": "How relevant the context is to service interactions",
          "formula": "service_impact * personalization_value",
          "definitions": {
            "high": "Directly affects how we should serve them - life transition, special circumstance",
            "low": "Interesting but doesn't change how we interact"
          }
        },
        {
          "id": "time_sensitivity",
          "name": "Time Sensitivity",
          "weight": 0.35,
          "description": "How time-bound the context is",
          "formula": "1 - decay_factor",
          "definitions": {
            "high": "Acute situation - recent event, ongoing process, upcoming deadline",
            "low": "Stable context - long-term situation, already resolved"
          }
        },
        {
          "id": "context_actionability",
          "name": "Actionability",
          "weight": 0.25,
          "description": "Whether we can take helpful action based on this context",
          "formula": "action_opportunities / total_context",
          "definitions": {
            "high": "Clear ways we can help or adapt - proactive offers possible",
            "low": "Background context only - no specific action indicated"
          }
        }
      ],
      "interpretationScale": [
        {
          "min": 0.0,
          "max": 0.3,
          "label": "Background Context",
          "implication": "Note for general awareness but no specific action"
        },
        {
          "min": 0.3,
          "max": 0.6,
          "label": "Relevant Context",
          "implication": "Worth remembering, may inform interaction approach"
        },
        {
          "min": 0.6,
          "max": 0.8,
          "label": "Active Context",
          "implication": "Currently affecting caller's needs - adapt service accordingly"
        },
        {
          "min": 0.8,
          "max": 1.0,
          "label": "Critical Context",
          "implication": "Urgent or highly impactful - prioritize and proactively address"
        }
      ],
      "scoringAnchors": [
        {
          "score": 0.2,
          "example": "I've been at my job for about 10 years now.",
          "rationale": "Stable background fact, not a current situation, doesn't change interaction",
          "isGold": true
        },
        {
          "score": 0.4,
          "example": "We're thinking about maybe getting a new car sometime next year.",
          "rationale": "Future possibility, vague timeline, might be relevant but not urgent",
          "isGold": true
        },
        {
          "score": 0.6,
          "example": "I just got a promotion so I'm looking at adjusting some of my coverage.",
          "rationale": "Recent life change with clear service implication, actionable",
          "isGold": true
        },
        {
          "score": 0.8,
          "example": "We're closing on our new house next Friday so I need to make sure the insurance is set up before then.",
          "rationale": "Time-sensitive, clear deadline, specific action needed, high stakes",
          "isGold": true
        },
        {
          "score": 0.95,
          "example": "My wife was just diagnosed with a serious illness and I'm trying to get our affairs in order. I need to understand all our policies and make sure she's protected.",
          "rationale": "Acute life crisis, emotionally significant, requires sensitivity and prioritization",
          "isGold": true
        }
      ],
      "promptGuidance": {
        "whenHigh": "Critical situation detected. This caller has an urgent or emotionally significant context. Be sensitive, prioritize their needs, and consider proactive outreach if appropriate.",
        "whenLow": "Background context only. Nice to know but doesn't change the interaction much.",
        "whenMedium": "Relevant situation worth remembering. May inform how you approach the interaction.",
        "promptTemplate": "{{#if (gte situational_context 0.8)}}SENSITIVE: Caller is dealing with {{context}} - approach with care and prioritize.{{else if (gte situational_context 0.5)}}Context: {{context}} - may be relevant to this interaction.{{/if}}"
      },
      "usedBy": [
        "AC-MEM-003"
      ]
    },
    {
      "id": "MEM_RELATIONS",
      "name": "relationships",
      "description": "People in the caller's life - family, friends, business contacts - and their relevance",
      "section": "Memory Types",
      "targetRange": {
        "min": 0.0,
        "max": 1.0
      },
      "formula": "identification_clarity * relationship_importance * service_relevance",
      "subMetrics": [
        {
          "id": "person_identification",
          "name": "Person Identification",
          "weight": 0.35,
          "description": "How clearly the person is identified",
          "formula": "name_given * role_clarity",
          "definitions": {
            "high": "Name and relationship clear - 'My husband John' or 'my daughter Sarah'",
            "low": "Vague reference - 'my family' or 'someone' or 'they'"
          }
        },
        {
          "id": "relationship_importance",
          "name": "Relationship Importance",
          "weight": 0.35,
          "description": "How important this relationship seems to the caller",
          "formula": "mention_frequency * emotional_weight",
          "definitions": {
            "high": "Core relationship - spouse, children, close family mentioned with emotion",
            "low": "Peripheral mention - acquaintance, one-time reference"
          }
        },
        {
          "id": "service_relevance",
          "name": "Service Relevance",
          "weight": 0.3,
          "description": "Whether this person is relevant to service (policy holder, beneficiary, etc.)",
          "formula": "account_connection * decision_influence",
          "definitions": {
            "high": "On the account, mentioned in coverage, involved in decisions",
            "low": "Not connected to service relationship"
          }
        }
      ],
      "interpretationScale": [
        {
          "min": 0.0,
          "max": 0.3,
          "label": "Peripheral Relationship",
          "implication": "Mentioned in passing, unlikely to be relevant"
        },
        {
          "min": 0.3,
          "max": 0.6,
          "label": "Notable Relationship",
          "implication": "Worth remembering for natural conversation"
        },
        {
          "min": 0.6,
          "max": 0.8,
          "label": "Important Relationship",
          "implication": "Key person in caller's life, reference appropriately"
        },
        {
          "min": 0.8,
          "max": 1.0,
          "label": "Primary Relationship",
          "implication": "Core relationship, may affect account decisions"
        }
      ],
      "scoringAnchors": [
        {
          "score": 0.2,
          "example": "Someone mentioned this company to me once.",
          "rationale": "Vague, anonymous, no ongoing relevance",
          "isGold": true
        },
        {
          "score": 0.4,
          "example": "My neighbor has the same insurance and said it was good.",
          "rationale": "Generic relationship, mentioned as reference only",
          "isGold": true
        },
        {
          "score": 0.6,
          "example": "My son is in college now - he's on my policy as an occasional driver.",
          "rationale": "Named relationship with service relevance, important to remember",
          "isGold": true
        },
        {
          "score": 0.8,
          "example": "My wife Karen handles most of our finances - she might call you about this too.",
          "rationale": "Named, may interact with account, decision influence, primary relationship",
          "isGold": true
        },
        {
          "score": 0.95,
          "example": "Everything needs to include my husband Michael - he's the primary on the account and we make all decisions together. He's been sick lately so I'm calling instead but he'll want to review everything.",
          "rationale": "Primary account holder, named, decision maker, current context affecting who calls",
          "isGold": true
        }
      ],
      "promptGuidance": {
        "whenHigh": "Primary relationship identified. Remember this person by name and role. They may be involved in account decisions or may contact us directly.",
        "whenLow": "Passing mention only. Don't over-index on this relationship.",
        "whenMedium": "Notable relationship worth remembering for personalized conversation.",
        "promptTemplate": "{{#if (gte relationships 0.7)}}Key relationship: {{person_name}} ({{relationship}}) - remember for future interactions{{/if}}"
      },
      "usedBy": [
        "AC-MEM-004"
      ]
    },
    {
      "id": "MEM_IMPORTANCE",
      "name": "memory_importance",
      "description": "Overall importance score determining which memories to prioritize for storage and replay",
      "section": "Memory Scoring",
      "targetRange": {
        "min": 0.0,
        "max": 1.0
      },
      "formula": "0.3 * personalization_value + 0.25 * emotional_significance + 0.25 * service_relevance + 0.2 * uniqueness",
      "subMetrics": [
        {
          "id": "personalization_value",
          "name": "Personalization Value",
          "weight": 0.3,
          "description": "How much this memory enables personalized service",
          "formula": "future_use_likelihood * personalization_impact",
          "definitions": {
            "high": "Will clearly enable better, more personal service in future",
            "low": "Generic information that doesn't differentiate service"
          }
        },
        {
          "id": "emotional_significance",
          "name": "Emotional Significance",
          "weight": 0.25,
          "description": "Emotional weight of the memory for the caller",
          "formula": "emotional_intensity * caller_emphasis",
          "definitions": {
            "high": "Meaningful life event, expressed with emotion, clearly important to caller",
            "low": "Transactional information, no emotional weight"
          }
        },
        {
          "id": "service_relevance",
          "name": "Service Relevance",
          "weight": 0.25,
          "description": "Direct relevance to service delivery",
          "formula": "account_impact * decision_relevance",
          "definitions": {
            "high": "Affects account, coverage, billing, or key service aspects",
            "low": "No direct service implications"
          }
        },
        {
          "id": "uniqueness",
          "name": "Memory Uniqueness",
          "weight": 0.2,
          "description": "How unique/specific this memory is vs generic information",
          "formula": "1 - commonality_score",
          "definitions": {
            "high": "Specific to this caller - names, dates, unique circumstances",
            "low": "Generic - 'has a family', 'drives a car'"
          }
        }
      ],
      "interpretationScale": [
        {
          "min": 0.0,
          "max": 0.3,
          "label": "Low Priority",
          "implication": "Don't store or store with low priority - likely to clutter memory"
        },
        {
          "min": 0.3,
          "max": 0.5,
          "label": "Standard Priority",
          "implication": "Store if space permits, not critical to recall"
        },
        {
          "min": 0.5,
          "max": 0.7,
          "label": "Important",
          "implication": "Should be stored and available for recall"
        },
        {
          "min": 0.7,
          "max": 1.0,
          "label": "Critical Memory",
          "implication": "Must store and prioritize for replay in future interactions"
        }
      ],
      "scoringAnchors": [
        {
          "score": 0.15,
          "example": "Memory: 'Caller said the weather was nice today'",
          "rationale": "No personalization value, no emotional significance, no service relevance, not unique",
          "isGold": true
        },
        {
          "score": 0.35,
          "example": "Memory: 'Caller mentioned they drive to work'",
          "rationale": "Minor personalization value, generic information, slight service relevance",
          "isGold": true
        },
        {
          "score": 0.55,
          "example": "Memory: 'Caller's son just got his driver's license'",
          "rationale": "Service relevant (insurance), some emotional significance (milestone), personalization potential",
          "isGold": true
        },
        {
          "score": 0.75,
          "example": "Memory: 'Daughter Emma starting at Ohio State in fall - will need to update policy for out-of-state'",
          "rationale": "High service relevance, personalization value, emotional milestone, specific details",
          "isGold": true
        },
        {
          "score": 0.95,
          "example": "Memory: 'Wife Karen recently diagnosed with illness - caller is worried about coverage and making sure family is protected. Very emotional call.'",
          "rationale": "Maximum emotional significance, high service relevance, critical context for future interactions",
          "isGold": true
        }
      ],
      "promptGuidance": {
        "whenHigh": "This is a critical memory that will significantly enhance future interactions. Prioritize storage and ensure it's surfaced in future calls with this customer.",
        "whenLow": "This information has low value for future interactions. Don't clutter the caller's profile with low-priority memories.",
        "whenMedium": "Worthwhile memory to store. Include in profile but don't prioritize over higher-importance items.",
        "promptTemplate": "{{#if (gte memory_importance 0.7)}}PRIORITY MEMORY: Store and surface in future interactions{{else if (lte memory_importance 0.3)}}Low priority - consider discarding{{/if}}"
      },
      "usedBy": [
        "AC-MEM-005"
      ]
    }
  ],
  "workedExamples": [
    {
      "paramId": "MEM_IMPORTANCE",
      "description": "Scoring a memory about caller's daughter going to college",
      "input": "Caller mentioned 'My daughter Emma is starting at Ohio State in the fall - we need to figure out the insurance situation for her car'",
      "calculations": [
        {
          "subMetric": "personalization_value",
          "formula": "Name (Emma) + school (Ohio State) + timeline (fall) = 0.8",
          "result": 0.8
        },
        {
          "subMetric": "emotional_significance",
          "formula": "Life milestone (college) + parental pride = 0.7",
          "result": 0.7
        },
        {
          "subMetric": "service_relevance",
          "formula": "Insurance implications + policy change needed = 0.9",
          "result": 0.9
        },
        {
          "subMetric": "uniqueness",
          "formula": "Specific name, school, timing = 0.85",
          "result": 0.85
        }
      ],
      "finalResult": {
        "value": 0.81,
        "interpretation": "Critical Memory - must store and prioritize for replay"
      }
    }
  ],
  "related": [
    {
      "id": "PERS-001",
      "title": "Big Five Personality Measurement",
      "relationship": "dependsOn - personality traits are stored as caller memories"
    },
    {
      "id": "CA-001",
      "title": "Cognitive Activation Assessment",
      "relationship": "informs - engagement level affects memory extraction quality"
    }
  ],
  "specRole": "EXTRACT"
}
