{
  "id": "INJECT-001",
  "title": "Pre-Call Data Injection",
  "version": "1.0",
  "status": "Draft",
  "date": "2026-01-31",
  "domain": "injection",
  "specType": "SYSTEM",
  "outputType": "COMPOSE",

  "story": {
    "asA": "pre-call preparation system",
    "iWant": "to assemble relevant content, memories, goals, and context for the upcoming call",
    "soThat": "the agent enters each call with the right data banks prepared"
  },

  "context": {
    "applies": "Before each call - prepares data banks for COMP-001 to assemble into prompt",
    "dependsOn": ["CURR-001", "MEM-001", "GOAL-001", "SESSION-001"],
    "assumptions": [
      "Caller may or may not have curriculum attached",
      "Memory and goal banks are always prepared",
      "Content bank is only prepared if caller has CONTENT spec attached",
      "Spaced retrieval logic uses CURR-001 review_status data"
    ]
  },

  "acceptanceCriteria": [
    {
      "id": "AC-INJECT-1",
      "title": "Content Bank Assembly",
      "given": "Caller has a CONTENT spec attached",
      "when": "Injection runs before call",
      "then": "Content bank includes new_units, recap_units, and review_units based on curriculum position",
      "measuredBy": ["content_bank_quality"]
    },
    {
      "id": "AC-INJECT-2",
      "title": "Memory Bank Assembly",
      "given": "Caller has memories from MEM-001",
      "when": "Injection runs before call",
      "then": "Relevant memories are selected and categorized for the agent",
      "measuredBy": ["memory_bank_quality"]
    },
    {
      "id": "AC-INJECT-3",
      "title": "Goal Bank Assembly",
      "given": "Caller has goals from GOAL-001",
      "when": "Injection runs before call",
      "then": "Active goals are prioritized and session objectives are set",
      "measuredBy": ["goal_bank_quality"]
    },
    {
      "id": "AC-INJECT-4",
      "title": "Context Bank Assembly",
      "given": "Caller has session history from SESSION-001",
      "when": "Injection runs before call",
      "then": "Session continuity context and open threads are prepared",
      "measuredBy": ["context_bank_quality"]
    },
    {
      "id": "AC-INJECT-5",
      "title": "No-Curriculum Caller Handling",
      "given": "Caller has NO curriculum attached (chat companion, etc.)",
      "when": "Injection runs before call",
      "then": "Content bank is empty but memory, goal, and context banks are still prepared",
      "measuredBy": ["no_curriculum_handling"]
    }
  ],

  "parameters": [
    {
      "id": "content_bank_quality",
      "name": "Content Bank Quality",
      "description": "Quality of content selection for callers with curriculum",
      "section": "content_injection",
      "appliesWhen": "caller has CONTENT spec attached",
      "config": {
        "newUnitsPerCall": { "min": 1, "max": 3 },
        "recapUnitsPerCall": { "min": 0, "max": 2 },
        "reviewTriggers": ["spaced_interval_due", "declining_mastery", "caller_request"]
      },
      "outputs": {
        "new_units": "Units to introduce this call (based on mastery + prerequisites)",
        "recap_units": "Recently mastered units to reinforce",
        "review_units": "Units due for spaced retrieval or with declining mastery"
      },
      "interpretationScale": [
        { "min": 0.8, "max": 1.0, "label": "Optimal Selection", "implication": "Right mix of new, recap, and review content" },
        { "min": 0.5, "max": 0.8, "label": "Good Selection", "implication": "Reasonable content selection" },
        { "min": 0.0, "max": 0.5, "label": "Poor Selection", "implication": "Content selection issues" }
      ],
      "scoringAnchors": [
        { "score": 1.0, "example": "2 new units (prerequisites met), 1 recap from last call, 1 review (overdue by 3 calls)", "rationale": "Balanced, appropriate selection", "isGold": true },
        { "score": 0.7, "example": "1 new unit selected, no recap or review despite overdue units", "rationale": "Missed review opportunity", "isGold": true },
        { "score": 0.3, "example": "3 new units selected when prerequisites not met for 2 of them", "rationale": "Prerequisite violation", "isGold": true }
      ],
      "promptGuidance": {
        "whenHigh": "Content selection is well-balanced for this caller's position.",
        "whenLow": "Review content selection logic - may be missing reviews or violating prerequisites."
      }
    },
    {
      "id": "memory_bank_quality",
      "name": "Memory Bank Quality",
      "description": "Quality of memory selection for all callers",
      "section": "memory_injection",
      "appliesWhen": "always",
      "config": {
        "memoriesLimit": 50,
        "memoriesPerCategory": 5,
        "relevanceThreshold": 0.5
      },
      "outputs": {
        "personal_facts": "Key facts about the caller",
        "preferences": "Caller's expressed preferences",
        "relationships": "Important people in caller's life",
        "context": "Current situational context"
      },
      "interpretationScale": [
        { "min": 0.8, "max": 1.0, "label": "Rich Context", "implication": "Comprehensive, relevant memories selected" },
        { "min": 0.5, "max": 0.8, "label": "Good Context", "implication": "Key memories included" },
        { "min": 0.0, "max": 0.5, "label": "Limited Context", "implication": "Few or irrelevant memories" }
      ],
      "scoringAnchors": [
        { "score": 1.0, "example": "Memories include: daughter Emma starting college, prefers email, dealing with job transition", "rationale": "Rich, relevant, actionable context", "isGold": true },
        { "score": 0.6, "example": "Memories include basic facts but miss recent context", "rationale": "Incomplete picture", "isGold": true },
        { "score": 0.2, "example": "Only generic memories, nothing recent or specific", "rationale": "Weak personalization potential", "isGold": true }
      ],
      "promptGuidance": {
        "whenHigh": "Memory bank provides rich personalization context.",
        "whenLow": "Consider what memories are missing - recent context? key relationships?"
      }
    },
    {
      "id": "goal_bank_quality",
      "name": "Goal Bank Quality",
      "description": "Quality of goal prioritization for all callers",
      "section": "goal_injection",
      "appliesWhen": "always",
      "config": {
        "activeGoalsLimit": 5,
        "staleGoalDays": 30
      },
      "outputs": {
        "active_goals": "Currently active goals, prioritized",
        "session_objectives": "Specific objectives for this call",
        "goal_progress": "Progress summary on each active goal"
      },
      "interpretationScale": [
        { "min": 0.8, "max": 1.0, "label": "Clear Goals", "implication": "Well-defined, prioritized goals" },
        { "min": 0.5, "max": 0.8, "label": "Some Goals", "implication": "Goals exist but may lack clarity" },
        { "min": 0.0, "max": 0.5, "label": "No Goals", "implication": "No active goals defined" }
      ],
      "scoringAnchors": [
        { "score": 1.0, "example": "Active goals: (1) Understand institutions framework [70% complete], (2) Apply to current events [not started]", "rationale": "Clear, prioritized, with progress", "isGold": true },
        { "score": 0.5, "example": "Goal exists but hasn't been referenced in 3 calls", "rationale": "May be stale", "isGold": true },
        { "score": 0.1, "example": "No goals defined for this caller", "rationale": "Consider goal discovery", "isGold": true }
      ],
      "promptGuidance": {
        "whenHigh": "Goals are clear - orient session around them.",
        "whenLow": "No clear goals - consider goal discovery in this session."
      }
    },
    {
      "id": "context_bank_quality",
      "name": "Context Bank Quality",
      "description": "Quality of session continuity context",
      "section": "context_injection",
      "appliesWhen": "always",
      "config": {
        "recentCallsLimit": 5,
        "openThreadsLimit": 3
      },
      "outputs": {
        "last_call_summary": "What happened in the previous call",
        "open_threads": "Unfinished topics or questions from recent calls",
        "session_arc_position": "Where caller is in multi-call learning arc",
        "time_since_last_call": "Days since last interaction"
      },
      "interpretationScale": [
        { "min": 0.8, "max": 1.0, "label": "Strong Continuity", "implication": "Clear connection to previous calls" },
        { "min": 0.5, "max": 0.8, "label": "Some Continuity", "implication": "Basic history available" },
        { "min": 0.0, "max": 0.5, "label": "Weak Continuity", "implication": "Limited or no history" }
      ],
      "scoringAnchors": [
        { "score": 1.0, "example": "Last call: covered Nogales case, open thread: student asked about China exception, arc: 2 of 5 modules complete", "rationale": "Rich continuity context", "isGold": true },
        { "score": 0.5, "example": "Last call summary available but no open threads tracked", "rationale": "Partial continuity", "isGold": true },
        { "score": 0.1, "example": "First call or no history available", "rationale": "Starting fresh", "isGold": true }
      ],
      "promptGuidance": {
        "whenHigh": "Strong continuity context - reference previous conversations naturally.",
        "whenLow": "Limited history - treat as new relationship or ask about recent progress."
      }
    },
    {
      "id": "no_curriculum_handling",
      "name": "No-Curriculum Caller Handling",
      "description": "Validates proper handling when caller has no curriculum attached",
      "section": "edge_cases",
      "appliesWhen": "caller has NO CONTENT spec attached",
      "interpretationScale": [
        { "min": 0.8, "max": 1.0, "label": "Proper Handling", "implication": "Content bank empty, other banks prepared" },
        { "min": 0.0, "max": 0.8, "label": "Handling Issue", "implication": "Error in no-curriculum path" }
      ],
      "scoringAnchors": [
        { "score": 1.0, "example": "Chat companion caller: content_bank=empty, memory_bank=full, goal_bank=full, context_bank=full", "rationale": "Correct no-curriculum handling", "isGold": true },
        { "score": 0.0, "example": "System errors when no curriculum attached", "rationale": "Edge case not handled", "isGold": true }
      ],
      "promptGuidance": {
        "whenHigh": "No-curriculum handling is correct.",
        "whenLow": "Fix no-curriculum edge case handling."
      }
    }
  ],

  "outputs": {
    "description": "INJECT-001 outputs JSON banks consumed by COMP-001",
    "banks": {
      "content_bank": {
        "description": "Curriculum content for this call (empty if no curriculum)",
        "structure": {
          "new_units": "array of unit objects to introduce",
          "recap_units": "array of unit objects to reinforce",
          "review_units": "array of unit objects for spaced retrieval"
        }
      },
      "memory_bank": {
        "description": "Relevant caller memories organized by category",
        "structure": {
          "personal_facts": "array of fact objects",
          "preferences": "array of preference objects",
          "relationships": "array of relationship objects",
          "context": "array of situational context objects"
        }
      },
      "goal_bank": {
        "description": "Active goals and session objectives",
        "structure": {
          "active_goals": "array of goal objects with progress",
          "session_objectives": "array of objectives for this call"
        }
      },
      "context_bank": {
        "description": "Session continuity context",
        "structure": {
          "last_call_summary": "string summary",
          "open_threads": "array of unfinished topics",
          "session_arc_position": "object with arc progress",
          "time_since_last_call": "number of days"
        }
      },
      "personality_bank": {
        "description": "Personality-based style guidance",
        "structure": {
          "trait_scores": "object with B5 scores",
          "style_targets": "object with ADAPT-computed targets"
        }
      }
    }
  },

  "constraints": [
    {
      "id": "C-INJECT-1",
      "type": "prerequisite",
      "description": "Content units must have prerequisites met before selection for new_units",
      "severity": "critical"
    },
    {
      "id": "C-INJECT-2",
      "type": "pacing",
      "description": "Limit new_units to 1-3 per call to avoid overload",
      "severity": "warning"
    },
    {
      "id": "C-INJECT-3",
      "type": "review",
      "description": "Units with declining mastery should be prioritized for review_units",
      "severity": "warning"
    },
    {
      "id": "C-INJECT-4",
      "type": "graceful",
      "description": "Must handle callers with no curriculum gracefully (empty content_bank)",
      "severity": "critical"
    }
  ],

  "related": [
    { "id": "CURR-001", "title": "Curriculum Tracking", "relationship": "provides progress data for content selection" },
    { "id": "MEM-001", "title": "Memory Extraction", "relationship": "provides memories for memory_bank" },
    { "id": "GOAL-001", "title": "Learner Goals", "relationship": "provides goals for goal_bank" },
    { "id": "SESSION-001", "title": "Session Planning", "relationship": "provides context for context_bank" },
    { "id": "ADAPT-PERS-001", "title": "Personality Adaptation", "relationship": "provides style targets for personality_bank" },
    { "id": "COMP-001", "title": "Prompt Composition", "relationship": "consumes INJECT output to build prompt" }
  ]
}
