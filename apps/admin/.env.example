# =============================================================================
# HF Admin Environment Configuration
# =============================================================================
#
# SETUP:
#   1. Copy this file:  cp .env.example .env.local
#   2. Fill in required values (marked [REQUIRED])
#   3. Uncomment and configure optional values as needed
#
# QUICK REFERENCE:
#   [REQUIRED]  DATABASE_URL         - PostgreSQL connection string
#   [REQUIRED]  HF_SUPERADMIN_TOKEN  - Admin authentication token
#   [RECOMMENDED] OPENAI_API_KEY     - For embeddings and AI features
#
# SECURITY:
#   - Never commit .env.local to version control
#   - Use strong, unique tokens (openssl rand -hex 32)
#   - Rotate API keys periodically
#
# =============================================================================


# -----------------------------------------------------------------------------
# Database [REQUIRED]
# -----------------------------------------------------------------------------
# PostgreSQL connection string. Format:
#   postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA
#
# Local development example:
DATABASE_URL="postgresql://hf_user:YOUR_PASSWORD@localhost:5432/hf?schema=public"


# -----------------------------------------------------------------------------
# Authentication [REQUIRED]
# -----------------------------------------------------------------------------
# NextAuth secret — used to encrypt JWT session tokens.
# Generate with: openssl rand -base64 32
AUTH_SECRET="generate-with-openssl-rand-base64-32"

# NextAuth URL — must match the app's public URL.
NEXTAUTH_URL="http://localhost:3000"

# Token required for superadmin API access and sensitive operations.
# Generate a secure 64-character hex token:
#   openssl rand -hex 32
HF_SUPERADMIN_TOKEN="generate-a-secure-token-here"

# Seed Admin Password [REQUIRED in production]
# Password for the initial SUPERADMIN account created by seed scripts.
# Used for first login only — password is auto-cleared after first use,
# forcing magic-link auth going forward.
# Generate with: openssl rand -base64 24
# SEED_ADMIN_PASSWORD=
# SEED_ADMIN_EMAIL=          # Override admin email per env (default: admin@test.com)

# -----------------------------------------------------------------------------
# Email (for invites and magic link login)
# -----------------------------------------------------------------------------
# Choose one option below. Required for invite system and magic link auth.

# Option 1: Resend (easiest)
# RESEND_API_KEY=re_your_resend_key
# EMAIL_FROM="HF <noreply@yourdomain.com>"

# Option 2: Custom SMTP
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USER=your-smtp-user
# SMTP_PASSWORD=your-smtp-password
# EMAIL_FROM="HF <noreply@yourdomain.com>"


# -----------------------------------------------------------------------------
# AI Services
# -----------------------------------------------------------------------------
# At least one AI provider is recommended for full functionality.
# OpenAI is used for embeddings; either provider works for completions.

# OpenAI [RECOMMENDED]
# Primary key for embeddings, completions, and AI-powered features.
# Get your key at: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-your-openai-key-here

# OpenAI Alternate Key (optional)
# If set, takes precedence over OPENAI_API_KEY. Useful for separating
# billing between projects or using organization-specific keys.
# OPENAI_HF_MVP_KEY=sk-your-alternate-key-here

# Anthropic Claude (optional)
# Used for Claude-powered completions when configured.
# Get your key at: https://console.anthropic.com/
# ANTHROPIC_API_KEY=sk-ant-your-anthropic-key-here

# Model Selection
# Override default models. Use model IDs from provider documentation.
# CLAUDE_MODEL_ID=claude-sonnet-4-20250514
# OPENAI_MODEL_ID=gpt-4o

# Generation Defaults
# These apply when not overridden by specific API calls.
# AI_DEFAULT_MAX_TOKENS=1024
# AI_DEFAULT_TEMPERATURE=0.7


# -----------------------------------------------------------------------------
# File Paths
# -----------------------------------------------------------------------------
# Configure where the app reads/writes data on the filesystem.

# Knowledge Base Directory
# Root directory for knowledge base files (prompts, templates, etc.)
# Can be absolute path or relative to apps/admin directory.
HF_KB_PATH=../../knowledge

# Parameters CSV (for import scripts)
# Path to CSV file used by parameter import utilities.
# HF_PARAMETERS_CSV=./backlog/parameters.csv

# Transcripts Directory
# Override default location for call transcript storage.
# HF_TRANSCRIPTS_PATH=/path/to/transcripts


# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------

# Filesystem Operations
# When enabled, allows the app to perform filesystem operations:
#   - Agent manifest sync
#   - Knowledge base file operations
#   - Transcript processing
# Set to "true" to enable; any other value disables.
HF_OPS_ENABLED=true


# -----------------------------------------------------------------------------
# Canonical Specs (Architectural Dependencies)
# -----------------------------------------------------------------------------
# These spec slugs define core system behavior. Override only if you need to
# swap in different specs for specific deployments (dev/staging/prod).
#
# ⚠️  WARNING: Changing these values requires corresponding specs to exist
# in your database. The system will fall back to defaults if specs are missing.

# Onboarding Spec
# Defines first-call experience, personas (tutor/companion/coach), and welcome
# templates. Default: INIT-001
# ONBOARDING_SPEC_SLUG=INIT-001

# Pipeline Configuration Spec
# Defines pipeline stages: EXTRACT → AGGREGATE → REWARD → ADAPT → SUPERVISE → COMPOSE
# Default: PIPELINE-001
# PIPELINE_SPEC_SLUG=PIPELINE-001

# Pipeline Fallback Spec
# Legacy spec used as fallback when PIPELINE-001 is not found.
# Default: GUARD-001
# PIPELINE_FALLBACK_SPEC_SLUG=GUARD-001

# Compose Spec
# The COMPOSE spec that drives prompt composition.
# Default: system-compose-next-prompt
# COMPOSE_SPEC_SLUG=system-compose-next-prompt

# Voice Spec Pattern
# Slug pattern used to find the voice/identity spec.
# Default: voice
# VOICE_SPEC_SLUG_PATTERN=voice

# Onboarding Slug Prefix
# Prefix for persona welcome/phase prompt slugs (e.g., init.welcome.tutor).
# Default: init.
# ONBOARDING_SLUG_PREFIX=init.


# -----------------------------------------------------------------------------
# VAPI Integration
# -----------------------------------------------------------------------------
# VAPI is the voice AI platform that handles phone calls.
# These settings are required for production VAPI integration.

# Webhook Secret [REQUIRED for production]
# HMAC-SHA256 secret shared with VAPI to verify webhook signatures.
# Without this, webhook auth is bypassed (acceptable for local dev only).
# Set this in VAPI dashboard → Server URL → Secret Token, then copy here.
# Generate with: openssl rand -hex 32
# VAPI_WEBHOOK_SECRET=your-vapi-webhook-secret-here

# Auto Pipeline
# When true, automatically triggers the analysis pipeline after each call.
# Set to "true" to enable. Default: false
# VAPI_AUTO_PIPELINE=false


# -----------------------------------------------------------------------------
# Application URLs
# -----------------------------------------------------------------------------

# Public App URL
# Base URL for the application. Used when generating absolute links
# (e.g., in emails, exports, or external integrations).
NEXT_PUBLIC_APP_URL=http://localhost:3000

# API URL
# Base URL for API requests. Typically same as app URL.
# Used by Playwright tests and external API clients.
# NEXT_PUBLIC_API_URL=http://localhost:3000

# Server Port
# Port for the Next.js development server. Default: 3000
# PORT=3000


# -----------------------------------------------------------------------------
# Polling & Timeouts
# -----------------------------------------------------------------------------
# All intervals are in milliseconds unless noted otherwise.
# Increase these values if you experience timeout issues.

# Health Check Interval
# How often to poll system health status. Default: 30 seconds
# HEALTH_CHECK_INTERVAL_MS=30000

# Agent Status Polling
# How often to refresh agent status in the UI. Default: 5 seconds
# AGENTS_POLL_INTERVAL_MS=5000

# System Status Polling
# How often to refresh overall system status. Default: 15 seconds
# STATUS_POLL_INTERVAL_MS=15000

# Docker Command Timeout
# Max time to wait for Docker commands to complete. Default: 5 seconds
# DOCKER_TIMEOUT_MS=5000


# -----------------------------------------------------------------------------
# Data Retention (GDPR)
# -----------------------------------------------------------------------------
# Configure automatic data retention periods.
# Set to 0 to disable (keep data indefinitely).
# External cron/scheduler calls POST /api/admin/retention/cleanup to process.

# Caller Data Retention (days)
# How long to keep caller data before eligible for cleanup.
# Default: 0 (disabled — data kept indefinitely)
# RETENTION_CALLER_DATA_DAYS=0

# Audit Log Retention (days)
# How long to keep audit log entries. Default: 365 days
# RETENTION_AUDIT_LOG_DAYS=365


# -----------------------------------------------------------------------------
# Testing
# -----------------------------------------------------------------------------
# Configuration for automated tests (Playwright, integration tests).

# Test API URL
# API endpoint used by integration tests. Usually matches NEXT_PUBLIC_API_URL.
# TEST_API_URL=http://localhost:3000

# Playwright Timeout (in seconds, not milliseconds)
# Max time for Playwright test operations. Default: 120 seconds
# PLAYWRIGHT_TIMEOUT_S=120


# =============================================================================
# TROUBLESHOOTING
# =============================================================================
#
# "Database connection failed"
#   - Verify PostgreSQL is running: pg_isready -h localhost -p 5432
#   - Check credentials in DATABASE_URL match your database setup
#   - Ensure database exists: createdb hf
#
# "Authentication failed" / 401 errors
#   - Verify HF_SUPERADMIN_TOKEN is set and matches your requests
#   - Token must be exactly 64 hex characters if using openssl rand -hex 32
#
# "AI features not working"
#   - Verify OPENAI_API_KEY is set and valid
#   - Check API key has sufficient credits/quota
#   - Test key: curl https://api.openai.com/v1/models -H "Authorization: Bearer $OPENAI_API_KEY"
#
# "Filesystem operations disabled"
#   - Set HF_OPS_ENABLED=true (must be exactly "true", case-sensitive)
#   - Verify HF_KB_PATH points to a valid, writable directory
#
# =============================================================================
